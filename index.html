<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Portfolio Dashboard - Fund Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .fund-management-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .add-fund-form {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #374151;
        }

        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #22c55e;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .holdings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .holdings-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .holdings-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        .holdings-table tr:hover {
            background: #f8fafc;
        }

        .fund-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-paused {
            background: #fef3c7;
            color: #92400e;
        }

        .status-deleted {
            background: #fee2e2;
            color: #991b1b;
        }

        .change-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .positive {
            color: #22c55e;
        }

        .negative {
            color: #ef4444;
        }

        .neutral {
            color: #64748b;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #22c55e;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .holdings-table {
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1><i class="fas fa-chart-line"></i> Portfolio Fund Manager</h1>
                <p style="color: #64748b; margin-top: 10px;">Add, Manage & Track Your Mutual Funds</p>
            </div>
            <div style="text-align: right;">
                <div style="color: #22c55e; font-weight: 500;">
                    <i class="fas fa-sync-alt"></i> Live Updates Every 30s
                </div>
                <div style="color: #64748b; font-size: 0.9rem; margin-top: 5px;" id="lastUpdate">
                    Last Update: July 26, 2025, 11:00 PM IST
                </div>
            </div>
        </div>

        <!-- Fund Management Panel -->
        <div class="fund-management-panel">
            <h2><i class="fas fa-plus-circle"></i> Add New Mutual Fund</h2>
            
            <div class="add-fund-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Fund Code/ISIN</label>
                        <input type="text" id="fundCode" placeholder="e.g., INF179K01VX0" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label>Fund Name</label>
                        <input type="text" id="fundName" placeholder="e.g., HDFC Gold ETF FoF" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="fundCategory">
                            <option value="">Select Category</option>
                            <option value="Large Cap">Large Cap</option>
                            <option value="Mid Cap">Mid Cap</option>
                            <option value="Small Cap">Small Cap</option>
                            <option value="Flexi Cap">Flexi Cap</option>
                            <option value="Multi Cap">Multi Cap</option>
                            <option value="ELSS">ELSS Tax Saver</option>
                            <option value="Index">Index Fund</option>
                            <option value="Sectoral">Sectoral/Thematic</option>
                            <option value="International">International</option>
                            <option value="Gold">Gold/Commodity</option>
                            <option value="Hybrid">Hybrid/Balanced</option>
                            <option value="Debt">Debt Fund</option>
                            <option value="FoF">Fund of Funds</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Initial Investment (₹)</label>
                        <input type="number" id="initialAmount" placeholder="10000" min="100">
                    </div>
                    <div class="form-group">
                        <label>Current NAV (₹)</label>
                        <input type="number" id="currentNAV" placeholder="45.50" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label>SIP Amount (₹)</label>
                        <input type="number" id="sipAmount" placeholder="1000" min="0">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="addNewFund()">
                    <i class="fas fa-plus"></i> Add Fund to Portfolio
                </button>
            </div>
        </div>

        <!-- Portfolio Holdings with Management -->
        <div class="fund-management-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-list"></i> Portfolio Holdings Management</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success btn-sm" onclick="refreshAllData()">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="exportPortfolio()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                </div>
            </div>

            <table class="holdings-table">
                <thead>
                    <tr>
                        <th>Fund Details</th>
                        <th>Current NAV</th>
                        <th>Day Change</th>
                        <th>Week Change</th>
                        <th>Current Value</th>
                        <th>P&L</th>
                        <th>Allocation</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="holdingsTableBody">
                    <!-- Holdings will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h3><i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> Confirm Fund Deletion</h3>
            <p style="margin: 20px 0;">Are you sure you want to permanently delete <strong id="deleteFundName"></strong> from your portfolio?</p>
            <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">This action cannot be undone. All transaction history will be removed.</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" style="background: #e5e7eb; color: #374151;" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Delete Fund
                </button>
            </div>
        </div>
    </div>

    <script>
        // Portfolio Data Management System
        class FundManager {
            constructor() {
                this.funds = this.loadPortfolioData();
                this.deleteFundCode = null;
                this.init();
            }

            init() {
                this.renderPortfolio();
                this.startAutoRefresh();
                this.setupEventListeners();
            }

            loadPortfolioData() {
                // Load from localStorage or return default data
                const saved = localStorage.getItem('portfolioFunds');
                if (saved) {
                    return JSON.parse(saved);
                }

                // Default portfolio data with day/week changes
                return [
                    {
                        fundCode: 'INF740KA1LG1',
                        fundName: 'DSP Healthcare Fund - Direct',
                        category: 'Sectoral',
                        currentNAV: 44.798,
                        previousNAV: 44.652,
                        weekAgoNAV: 43.891,
                        units: 617.919,
                        currentValue: 27681,
                        investedValue: 27099,
                        allocation: 19.1,
                        status: 'active',
                        sipAmount: 3000
                    },
                    {
                        fundCode: 'INF179K01VX0',
                        fundName: 'HDFC Gold ETF FoF - Direct',
                        category: 'Gold',
                        currentNAV: 31.0659,
                        previousNAV: 30.8234,
                        weekAgoNAV: 29.7845,
                        units: 714.511,
                        currentValue: 22201,
                        investedValue: 18849,
                        allocation: 15.3,
                        status: 'active',
                        sipAmount: 2000
                    },
                    {
                        fundCode: 'INF179KC1IO9',
                        fundName: 'HDFC Nifty500 Multicap - Direct',
                        category: 'Index',
                        currentNAV: 9.9921,
                        previousNAV: 9.9234,
                        weekAgoNAV: 9.7845,
                        units: 1894.97,
                        currentValue: 18934,
                        investedValue: 17749,
                        allocation: 13.1,
                        status: 'active',
                        sipAmount: 2000
                    },
                    {
                        fundCode: 'INF879O01175',
                        fundName: 'Parag Parikh Conservative - Direct',
                        category: 'Hybrid',
                        currentNAV: 15.3712,
                        previousNAV: 15.3456,
                        weekAgoNAV: 15.1234,
                        units: 1962.472,
                        currentValue: 30167,
                        investedValue: 28499,
                        allocation: 20.8,
                        status: 'active',
                        sipAmount: 3000
                    },
                    {
                        fundCode: 'INF879O01027',
                        fundName: 'Parag Parikh Flexi Cap - Direct',
                        category: 'Flexi Cap',
                        currentNAV: 92.5071,
                        previousNAV: 91.8765,
                        weekAgoNAV: 89.4567,
                        units: 149.502,
                        currentValue: 13831,
                        investedValue: 12999,
                        allocation: 9.5,
                        status: 'active',
                        sipAmount: 1500
                    },
                    {
                        fundCode: 'INF247L01569',
                        fundName: 'Motilal Oswal ELSS - Direct',
                        category: 'ELSS',
                        currentNAV: 61.4999,
                        previousNAV: 61.2345,
                        weekAgoNAV: 59.8765,
                        units: 324.375,
                        currentValue: 19945,
                        investedValue: 18499,
                        allocation: 13.8,
                        status: 'active',
                        sipAmount: 2000
                    },
                    {
                        fundCode: 'INF247L01BY3',
                        fundName: 'Motilal Oswal Small Cap - Direct',
                        category: 'Small Cap',
                        currentNAV: 14.6172,
                        previousNAV: 14.5234,
                        weekAgoNAV: 14.1234,
                        units: 691.097,
                        currentValue: 10102,
                        investedValue: 9500,
                        allocation: 7.0,
                        status: 'active',
                        sipAmount: 1000
                    },
                    {
                        fundCode: 'INF205K01A24',
                        fundName: 'Invesco Pan European - Direct',
                        category: 'International',
                        currentNAV: 21.6073,
                        previousNAV: 21.5234,
                        weekAgoNAV: 21.3456,
                        units: 92.921,
                        currentValue: 2008,
                        investedValue: 2000,
                        allocation: 1.4,
                        status: 'paused',
                        sipAmount: 0
                    }
                ];
            }

            savePortfolioData() {
                localStorage.setItem('portfolioFunds', JSON.stringify(this.funds));
            }

            calculateDayChange(currentNAV, previousNAV) {
                if (!previousNAV || previousNAV === 0) return 0;
                return ((currentNAV - previousNAV) / previousNAV * 100);
            }

            calculateWeekChange(currentNAV, weekAgoNAV) {
                if (!weekAgoNAV || weekAgoNAV === 0) return 0;
                return ((currentNAV - weekAgoNAV) / weekAgoNAV * 100);
            }

            renderPortfolio() {
                const tbody = document.getElementById('holdingsTableBody');
                tbody.innerHTML = '';

                this.funds.forEach(fund => {
                    const dayChange = this.calculateDayChange(fund.currentNAV, fund.previousNAV);
                    const weekChange = this.calculateWeekChange(fund.currentNAV, fund.weekAgoNAV);
                    const pnl = fund.currentValue - fund.investedValue;
                    const pnlPercent = (pnl / fund.investedValue * 100);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 8px; height: 30px; background: ${this.getCategoryColor(fund.category)}; border-radius: 4px;"></div>
                                <div>
                                    <strong>${fund.fundName}</strong>
                                    <div style="font-size: 0.8rem; color: #64748b;">${fund.category} • ${fund.fundCode}</div>
                                </div>
                            </div>
                        </td>
                        <td>₹${fund.currentNAV.toFixed(4)}</td>
                        <td>
                            <div class="change-indicator ${dayChange >= 0 ? 'positive' : 'negative'}">
                                <i class="fas fa-${dayChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                                ${dayChange.toFixed(2)}%
                            </div>
                        </td>
                        <td>
                            <div class="change-indicator ${weekChange >= 0 ? 'positive' : 'negative'}">
                                <i class="fas fa-${weekChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                                ${weekChange.toFixed(2)}%
                            </div>
                        </td>
                        <td>₹${fund.currentValue.toLocaleString()}</td>
                        <td>
                            <div class="change-indicator ${pnl >= 0 ? 'positive' : 'negative'}">
                                ${pnl >= 0 ? '+' : ''}₹${pnl.toLocaleString()}
                                <div style="font-size: 0.8rem;">(${pnlPercent.toFixed(2)}%)</div>
                            </div>
                        </td>
                        <td>${fund.allocation}%</td>
                        <td>
                            <span class="fund-status status-${fund.status}">
                                <i class="fas fa-${fund.status === 'active' ? 'play' : fund.status === 'paused' ? 'pause' : 'times'}"></i>
                                ${fund.status.charAt(0).toUpperCase() + fund.status.slice(1)}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn ${fund.status === 'active' ? 'btn-warning' : 'btn-success'} btn-sm" 
                                        onclick="fundManager.toggleFundStatus('${fund.fundCode}')">
                                    <i class="fas fa-${fund.status === 'active' ? 'pause' : 'play'}"></i>
                                    ${fund.status === 'active' ? 'Pause' : 'Resume'}
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="fundManager.deleteFund('${fund.fundCode}', '${fund.fundName}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            getCategoryColor(category) {
                const colors = {
                    'Sectoral': '#ef4444',
                    'Gold': '#f59e0b',
                    'Index': '#22c55e',
                    'Hybrid': '#3b82f6',
                    'Flexi Cap': '#8b5cf6',
                    'ELSS': '#ec4899',
                    'Small Cap': '#06b6d4',
                    'International': '#64748b',
                    'Large Cap': '#10b981',
                    'Mid Cap': '#f97316',
                    'Multi Cap': '#84cc16',
                    'Debt': '#6366f1',
                    'FoF': '#14b8a6'
                };
                return colors[category] || '#64748b';
            }

            toggleFundStatus(fundCode) {
                const fund = this.funds.find(f => f.fundCode === fundCode);
                if (fund) {
                    fund.status = fund.status === 'active' ? 'paused' : 'active';
                    this.savePortfolioData();
                    this.renderPortfolio();
                    this.showNotification(
                        `${fund.fundName} ${fund.status === 'active' ? 'resumed' : 'paused'} successfully`,
                        'success'
                    );
                }
            }

            deleteFund(fundCode, fundName) {
                this.deleteFundCode = fundCode;
                document.getElementById('deleteFundName').textContent = fundName;
                document.getElementById('deleteModal').style.display = 'block';
            }

            confirmDelete() {
                if (this.deleteFundCode) {
                    const fundIndex = this.funds.findIndex(f => f.fundCode === this.deleteFundCode);
                    if (fundIndex > -1) {
                        const deletedFund = this.funds.splice(fundIndex, 1)[0];
                        this.savePortfolioData();
                        this.renderPortfolio();
                        this.showNotification(`${deletedFund.fundName} deleted successfully`, 'success');
                    }
                }
                this.closeDeleteModal();
            }

            closeDeleteModal() {
                document.getElementById('deleteModal').style.display = 'none';
                this.deleteFundCode = null;
            }

            async simulateNAVUpdate() {
                // Simulate live NAV updates with realistic variations
                this.funds.forEach(fund => {
                    const variation = (Math.random() - 0.5) * 0.02; // ±1% variation
                    fund.previousNAV = fund.currentNAV;
                    fund.currentNAV = fund.currentNAV * (1 + variation);
                    fund.currentValue = fund.units * fund.currentNAV;
                });
                
                this.savePortfolioData();
                this.renderPortfolio();
                this.updateTimestamp();
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.simulateNAVUpdate();
                }, 30000); // 30 seconds
            }

            updateTimestamp() {
                const now = new Date();
                const timeString = now.toLocaleString('en-IN', { 
                    timeZone: 'Asia/Kolkata',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('lastUpdate').textContent = `Last Update: ${timeString}`;
            }

            setupEventListeners() {
                // Close modal when clicking outside
                window.onclick = (event) => {
                    const modal = document.getElementById('deleteModal');
                    if (event.target === modal) {
                        this.closeDeleteModal();
                    }
                };
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type} show`;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }
        }

        // Global Functions
        let fundManager;

        function addNewFund() {
            const fundCode = document.getElementById('fundCode').value.trim();
            const fundName = document.getElementById('fundName').value.trim();
            const category = document.getElementById('fundCategory').value;
            const initialAmount = parseFloat(document.getElementById('initialAmount').value);
            const currentNAV = parseFloat(document.getElementById('currentNAV').value);
            const sipAmount = parseFloat(document.getElementById('sipAmount').value) || 0;

            // Validation
            if (!fundCode || !fundName || !category || !initialAmount || !currentNAV) {
                fundManager.showNotification('Please fill all required fields', 'error');
                return;
            }

            // Check for duplicate fund code
            if (fundManager.funds.find(f => f.fundCode === fundCode)) {
                fundManager.showNotification('Fund with this code already exists', 'error');
                return;
            }

            // Calculate units and other values
            const units = initialAmount / currentNAV;
            const currentValue = units * currentNAV;

            // Create new fund object
            const newFund = {
                fundCode,
                fundName,
                category,
                currentNAV,
                previousNAV: currentNAV * 0.999, // Simulate previous day NAV
                weekAgoNAV: currentNAV * 0.985, // Simulate week ago NAV
                units,
                currentValue,
                investedValue: initialAmount,
                allocation: 0, // Will be recalculated
                status: 'active',
                sipAmount
            };

            // Add to portfolio
            fundManager.funds.push(newFund);
            
            // Recalculate allocations
            const totalValue = fundManager.funds.reduce((sum, fund) => sum + fund.currentValue, 0);
            fundManager.funds.forEach(fund => {
                fund.allocation = parseFloat((fund.currentValue / totalValue * 100).toFixed(1));
            });

            fundManager.savePortfolioData();
            fundManager.renderPortfolio();
            fundManager.showNotification(`${fundName} added successfully to portfolio`, 'success');

            // Clear form
            document.getElementById('fundCode').value = '';
            document.getElementById('fundName').value = '';
            document.getElementById('fundCategory').value = '';
            document.getElementById('initialAmount').value = '';
            document.getElementById('currentNAV').value = '';
            document.getElementById('sipAmount').value = '';
        }

        function refreshAllData() {
            fundManager.simulateNAVUpdate();
            fundManager.showNotification('Portfolio data refreshed successfully', 'success');
        }

        function exportPortfolio() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Fund Code,Fund Name,Category,Current NAV,Day Change %,Week Change %,Current Value,P&L,Allocation %,Status\n" +
                fundManager.funds.map(fund => {
                    const dayChange = fundManager.calculateDayChange(fund.currentNAV, fund.previousNAV);
                    const weekChange = fundManager.calculateWeekChange(fund.currentNAV, fund.weekAgoNAV);
                    const pnl = fund.currentValue - fund.investedValue;
                    
                    return [
                        fund.fundCode,
                        `"${fund.fundName}"`,
                        fund.category,
                        fund.currentNAV.toFixed(4),
                        dayChange.toFixed(2),
                        weekChange.toFixed(2),
                        fund.currentValue.toFixed(2),
                        pnl.toFixed(2),
                        fund.allocation,
                        fund.status
                    ].join(',');
                }).join('\n');

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `portfolio_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            fundManager.showNotification('Portfolio exported successfully', 'success');
        }

        function closeDeleteModal() {
            fundManager.closeDeleteModal();
        }

        function confirmDelete() {
            fundManager.confirmDelete();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            fundManager = new FundManager();
            
            // Show startup notification
            setTimeout(() => {
                fundManager.showNotification('Portfolio Fund Manager loaded successfully', 'success');
            }, 1000);
        });
    </script>
</body>
</html>
